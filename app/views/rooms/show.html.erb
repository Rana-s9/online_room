<% content_for :main_class, "relative w-full flex flex-col mt-0" %>
<div class="fixed top-[25px] md:top-[60px] left-1/2 transform -translate-x-1/2 z-40 p-4">
  <div class="text-matcha text-center text-md md:text-2xl font-bold rounded-lg shadow-md p-2">
    <%= @room.name %><i class="fa-solid fa-house-user"></i>
  </div>
</div>
<%= render 'weather' %>
<%= render 'board' %>

<% if @room.user_id == current_user.id %>
  <div class="group relative">
    <%= link_to room_invitation_tokens_path(@room),
        class: "fixed top-[200px] md:top-[100px] right-4 z-50 flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-matcha-green hover:bg-matcha hover:scale-110 transition-transform duration-300",
        data: { turbo: false, label: t('views.room_show.invitation') },
        href: room_invitation_tokens_path(@room) do %>
      <i class="fa-solid fa-user-plus text-2xl transition-transform duration-300 group-hover:rotate-[12deg]"></i>
    <% end %>

    <span class="fixed top-[200px] md:top-[100px] right-4 -translate-y-1/2
                opacity-0 md:opacity-0 md:group-hover:opacity-100
                bg-beige text-xs md:text-sm rounded px-2 py-1 shadow
                transition-opacity duration-300 whitespace-nowrap z-50 pointer-events-none">
      <%= t('views.room_show.invitation') %>
    </span>
  </div>
<% end %>

<!--%= render 'calendar' %>-->


<%= render 'greeting' %>
<div class="group relative">
  <%= link_to room_exchange_diaries_path(@room),
      class: "fixed top-[250px] md:top-[150px] right-4 z-50 flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-beige hover:bg-blue-600 hover:scale-110 transition-transform duration-300",
      data: { turbo: false, label: t('views.room_show.diary') },
      href: room_exchange_diaries_path(@room) do %>
    <i class="fa-solid fa-book-open text-2xl transition-transform duration-300 group-hover:rotate-[12deg]"></i>
  <% end %>

  <span class="fixed top-[250px] md:top-[150px] right-4 -translate-y-1/2
               opacity-0 md:opacity-0 md:group-hover:opacity-100
               bg-beige text-xs md:text-sm rounded px-2 py-1 shadow
               transition-opacity duration-300 whitespace-nowrap z-50 pointer-events-none">
    <%= t('views.room_show.diary') %>
  </span>
</div>

<div class="group relative">
  <%= link_to room_spots_path(@room),
      class: "fixed top-[300px] md:top-[200px] right-4 z-40 flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-beige hover:bg-blue-600 hover:scale-110 transition-transform duration-300",
      data: { turbo: false, label: t('views.room_show.place') },
      href: room_spots_path(@room) do %>
    <i class="fa-solid fa-map-pin text-2xl transition-transform duration-300 group-hover:rotate-[12deg]"></i>
  <% end %>

  <span class="fixed top-[300px] md:top-[200px] right-4 -translate-y-1/2
               opacity-0 md:opacity-0 md:group-hover:opacity-100
               bg-beige text-xs md:text-sm rounded px-2 py-1 shadow
               transition-opacity duration-300 whitespace-nowrap z-50 pointer-events-none">
    <%= t('views.room_show.place') %>
  </span>
</div>

<div class="group relative">
  <%= link_to room_state_calendars_path(@room),
      class: "fixed top-[350px] md:top-[250px] right-4 z-40 flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-beige hover:bg-blue-600 hover:scale-110 transition-transform duration-300",
      data: { turbo: false, label: t('views.room_show.state') },
      href: room_state_calendars_path(@room) do %>
    <i class="fa-solid fa-briefcase-medical text-2xl transition-transform duration-300 group-hover:rotate-[12deg]"></i>
  <% end %>

  <span class="fixed top-[350px] md:top-[250px] right-4 -translate-y-1/2
               opacity-0 md:opacity-0 md:group-hover:opacity-100
               bg-beige text-xs md:text-sm rounded px-2 py-1 shadow
               transition-opacity duration-300 whitespace-nowrap z-50 pointer-events-none">
    <%= t('views.room_show.state') %>
  </span>
</div>

<div class="group relative">
  <%= link_to room_calendars_path(@room),
      class: "fixed top-[400px] md:top-[300px] right-4 z-40 flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-beige hover:bg-blue-600 hover:scale-110 transition-transform duration-300",
      data: { turbo: false, label: t('views.room_show.calendar') },
      href: room_calendars_path(@room) do %>
    <i class="fa-solid fa-calendar text-2xl transition-transform duration-300 group-hover:rotate-[12deg]"></i>
  <% end %>

  <span class="fixed top-[400px] md:top-[300px] right-4 -translate-y-1/2
               opacity-0 md:opacity-0 md:group-hover:opacity-100
               bg-beige text-xs md:text-sm rounded px-2 py-1 shadow
               transition-opacity duration-300 whitespace-nowrap z-50 pointer-events-none">
    <%= t('views.room_show.calendar') %>
  </span>
</div>

<div class="group relative">
  <%= link_to room_greetings_path(@room),
      class: "fixed top-[450px] md:top-[600px] right-4 z-50 flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-matcha-green hover:bg-matcha hover:scale-110 transition-transform duration-300",
      data: { turbo: false, label: t('views.room_show.message') },
      href: room_greetings_path(@room) do %>
    <i class="fa-solid fa-comment text-2xl transition-transform duration-300 group-hover:rotate-[12deg]"></i>
  <% end %>

  <span class="fixed top-[450px] md:top-[600px] right-4 -translate-y-1/2
               opacity-0 md:opacity-0 md:group-hover:opacity-100
               bg-beige text-xs md:text-sm rounded px-2 py-1 shadow
               transition-opacity duration-300 whitespace-nowrap z-50 pointer-events-none">
    <%= t('views.room_show.message') %>
  </span>
</div>

<div class="absolute bottom-20 lg:bottom-32 right-0 z-40 bg-white/80 p-4 rounded-lg shadow-md text-matcha text-xs md:text-lg font-bold text-right max-w-xs">
  <% if current_user.calendars.exists?(visibility: 'together') && @calendar.present? %>
      <%= t("views.calendar.share_calendar") %> <br>
      <%= link_to @calendar.name, room_calendars_path(@room), class: "calendar-link" %><br>
      <% if @calendar.start_time.beginning_of_day == @calendar.start_time && @calendar.end_time.end_of_day == @calendar.end_time %>
        <%= l(@calendar.start_time.to_date, format: :long) %>
      <% else %>
        <%= l(@calendar.start_time, format: :long) %> ～ <%= l(@calendar.end_time, format: :long) %>
      <% end %>
  <% else %>
    <%= t("views.calendar.no_share_calendar") %>
  <% end %>
</div>

<% if mobile_device? %>
  <%= image_tag '/gif.gif' %>
<% else %>
  <%= render 'home' %>
  <div id="loading-screen" style="position:absolute; top:0; left:0; width:100%; height:100%; background:yellow/30; z-index:10; display:flex; align-items:center; justify-content:center; pointer-events:none;">
    <div class="text-center text-matcha text-2xl animate-bounce font-bold">
      <%= t('views.room_show.cleaning') %>...🧹
    </div>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.innerWidth < 768) {
      document.querySelectorAll('.group > a[data-label]').forEach(btn => {
        const label = btn.nextElementSibling;
        btn.addEventListener('click', (e) => {
          if (!label.classList.contains('opacity-100')) {
            e.preventDefault(); // 1回目クリックで遷移キャンセル
            label.classList.remove('opacity-0');
            label.classList.add('opacity-100');
          }
          // 2回目クリックでリンク遷移
        });
      });
    }
  });
</script>
